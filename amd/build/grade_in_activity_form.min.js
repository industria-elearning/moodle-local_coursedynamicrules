define("local_coursedynamicrules/grade_in_activity_form",["exports","core_form/dynamicform","core/notification","core/pending","core/str"],(function(_exports,_dynamicform,_notification,_pending,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module grade_in_activity_form
   *
   * @module     local_coursedynamicrules/grade_in_activity_form
   * @copyright  2024 Industria Elearning <info@industriaelearning.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function attachCourseModuleChangeListener(dynamicForm){const courseModuleSelect=document.querySelector("[name=coursemodule]");courseModuleSelect?courseModuleSelect.addEventListener("change",(e=>{!function(dynamicForm,courseModuleValue){const updatePromise=new _pending.default("local_coursedynamicrules/grade_in_activity_form:update"),courseId=document.querySelector("[name=courseid]").value;dynamicForm.load({coursemodule:courseModuleValue,courseid:courseId}).then((()=>(attachCourseModuleChangeListener(dynamicForm),resetGradeItems(),updateGradeItems(),updatePromise.resolve()))).catch(_notification.default.exception)}(dynamicForm,e.target.value)})):_notification.default.addNotification({message:"Course module select element not found.",type:"warning"})}function resetGradeItems(){document.querySelector("[name=gradeitems]").value=JSON.stringify({})}function updateGradeItems(){const cmId=document.querySelector("[name=coursemodule]").value;document.querySelector("[name=cmid]").value=cmId;document.querySelectorAll("[data-cmid='".concat(cmId,"']")).forEach((input=>{updateGradeItem(input),input.addEventListener("change",(e=>{updateGradeItem(e.target)}))}))}function updateGradeItem(input){const gradeItems=document.querySelector("[name=gradeitems]").value,gradeItemsObject=JSON.parse(gradeItems),condition=input.dataset.condition,gradeItem=input.dataset.gradeitem,value=input.value,disabled="disabled"===input.getAttribute("disabled");gradeItemsObject["".concat(condition,"_").concat(gradeItem)]={gradeitem:gradeItem,condition:condition,value:value,disabled:disabled},document.querySelector("[name=gradeitems]").value=JSON.stringify(gradeItemsObject)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(){const formContainer=document.querySelector("[data-region=dynamicform]");!function(dynamicForm){const loadPromise=new _pending.default(" local_coursedynamicrules/grade_in_activity_form:load"),courseId=document.querySelector("[name=courseid]").value;dynamicForm.load({courseid:courseId}).then((()=>{attachCourseModuleChangeListener(dynamicForm),resetGradeItems(),updateGradeItems();const gradeInActivityForm=document.getElementById("grade_in_activity_form");document.getElementById("dynamic_grade_in_activity_form");let formIsValid=!0;return gradeInActivityForm.addEventListener("submit",(e=>{e.preventDefault();const cmId=document.querySelector("[name=coursemodule]").value;document.querySelectorAll("[data-cmid='".concat(cmId,"']")).forEach((input=>{const gradeMin=input.dataset.grademin,gradeMax=input.dataset.grademax;let invalidFeedback=input.nextElementSibling;input.disabled||(invalidFeedback&&invalidFeedback.classList.contains("invalid-feedback")||(invalidFeedback=document.createElement("span"),invalidFeedback.className="invalid-feedback",input.after(invalidFeedback)),console.log({value:input.value,gradeMin:gradeMin,gradeMax:gradeMax}),(input.value>gradeMax||input.value<gradeMin)&&(input.classList.add("is-invalid"),formIsValid=!1,(0,_str.get_string)("errorgradeoutofrange","local_coursedynamicrules",{min:gradeMin,max:gradeMax}).then((function(content){invalidFeedback.textContent=content})).catch((function(){notification.exception(new Error("Failed to load string: restore"))}))))}))})),loadPromise.resolve()})).catch(_notification.default.exception)}((container=formContainer,new _dynamicform.default(container,"local_coursedynamicrules\\form\\conditions\\dynamic_grade_in_activity_form")));var container},_dynamicform=_interopRequireDefault(_dynamicform),_notification=_interopRequireDefault(_notification),_pending=_interopRequireDefault(_pending)}));

//# sourceMappingURL=grade_in_activity_form.min.js.map